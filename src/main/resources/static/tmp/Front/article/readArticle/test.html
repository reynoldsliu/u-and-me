<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件上传和预览</title>
</head>

<body>

    <form id="picForm">
        <div class="mb-2 mt-5">
            <p>上傳照片</p>

            <div id="fileInputs" style="margin-bottom: 20px;">
                  <!-- 動態生成上傳欄位 -->
            </div>
            <button type="button" id="addFileButton" class="btn btn-secondary"
                style="margin-bottom: 40px;">新增圖片</button>
        </div>
        <!-- <button type="submit" class="btn btn-primary-send">發表</button> -->
    </form>

    <script>
        const fileInputsContainer = document.getElementById('fileInputs');
        const addFileButton_el = document.getElementById('addFileButton');

        addFileButton_el.addEventListener('click', function () {
            // 包著預覽圖與上傳欄位的div
            const imagePreviewContainer = document.createElement('div');
            // 上傳欄位
            const newFileInput = document.createElement('input');
            // 預覽圖
            const imagePreview = document.createElement('img');

            newFileInput.type = 'file';
            newFileInput.name = 'files';
            newFileInput.className = 'form-control';
            // event参数包含了关于事件的信息，包括用户选择的文件。
            newFileInput.addEventListener('change', function (event) {
                // event.target表示触发事件的元素(也就是新增的檔案)，而files属性是一个包含用户选择文件的文件列表。
                // 因为選擇檔案時可一次選多個，使用[0]來解析選擇圖片中的第一個。
                const file = event.target.files[0];
                // 檢查file是否確實有被選中檔案，而不是取消上傳等其他動作
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        imagePreview.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                    // 将文件内容读取为数据 URL（以data:开头的 URL）。这个 URL 包含了文件的二进制数据，可以直接用于图像预览。
                }
            });

            fileInputsContainer.appendChild(imagePreviewContainer);
            imagePreviewContainer.appendChild(newFileInput);
            imagePreviewContainer.appendChild(imagePreview);
        });
    </script>
</body>

</html>
